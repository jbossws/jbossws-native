<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ JBoss, Home of Professional Open Source.
  ~ Copyright 2011, Red Hat, Inc., and individual contributors
  ~ as indicated by the @author tags. See the copyright.txt file in the
  ~ distribution for a full listing of individual contributors.
  ~
  ~ This is free software; you can redistribute it and/or modify it
  ~ under the terms of the GNU Lesser General Public License as
  ~ published by the Free Software Foundation; either version 2.1 of
  ~ the License, or (at your option) any later version.
  ~
  ~ This software is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  ~ Lesser General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Lesser General Public
  ~ License along with this software; if not, write to the Free
  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.
  -->

<project>

  <!-- ================================================================== -->
  <!-- Generating sources                                                 -->
  <!-- ================================================================== -->

  <target name="wstools" description="Generate the JAX-RPC artifacts.">
    <antcall target="generate-sources"/>
    <antcall target="compile-sources"/>
    <antcall target="copy-resources"/>
  </target>

  <!-- Generate JAX-RPC artifacts -->
  <target name="generate-sources">

    <taskdef name="wstools" classname="org.jboss.ws.tools.ant.wstools">
      <classpath>
        <pathelement path="${maven.test.classpath}"/>
      </classpath>
    </taskdef>

    <macro-wstools dest="jaxrpc/samples/docstyle/wrapped/WEB-INF" config="jaxrpc/samples/docstyle/wrapped/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/docstyle/bare/WEB-INF" config="jaxrpc/samples/docstyle/bare/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/dynamichandler/WEB-INF" config="jaxrpc/samples/dynamichandler/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/exception/WEB-INF" config="jaxrpc/samples/exception/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/handler/WEB-INF" config="jaxrpc/samples/handler/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/holder/WEB-INF" config="jaxrpc/samples/holder/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/jsr109ejb/doclit/META-INF" config="jaxrpc/samples/jsr109ejb/doclit/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/jsr109ejb/rpclit/META-INF" config="jaxrpc/samples/jsr109ejb/rpclit/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/jsr109pojo/doclit/WEB-INF" config="jaxrpc/samples/jsr109pojo/doclit/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/jsr109pojo/rpclit/WEB-INF" config="jaxrpc/samples/jsr109pojo/rpclit/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/message/WEB-INF" config="jaxrpc/samples/message/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/oneway/WEB-INF" config="jaxrpc/samples/oneway/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/rpcstyle/WEB-INF" config="jaxrpc/samples/rpcstyle/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/secureejb/META-INF" config="jaxrpc/samples/secureejb/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/wsaddr/hello/WEB-INF" config="jaxrpc/samples/wsaddr/hello/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/wsaddr/replyto/WEB-INF" config="jaxrpc/samples/wsaddr/replyto/wstools-config.xml"/>
    <macro-wstools dest="jaxrpc/samples/wssecurity/WEB-INF" config="jaxrpc/samples/wssecurity/wstools-config.xml"/>

  </target>

  <target name="compile-sources">

    <mkdir dir="${tests.output.dir}/wstools/java"/>
    <move todir="${tests.output.dir}/wstools/java">
      <fileset dir="${tests.output.dir}/wstools/resources/jaxrpc/samples/docstyle/wrapped/WEB-INF" includes="org/**"/>
    </move>
    <move todir="${tests.output.dir}/wstools/java">
      <fileset dir="${tests.output.dir}/wstools/resources/jaxrpc/samples/wsaddr/hello/WEB-INF" includes="org/**"/>
    </move>
    <move todir="${tests.output.dir}/wstools/java">
      <fileset dir="${tests.output.dir}/wstools/resources/jaxrpc/samples/wsaddr/replyto/WEB-INF" includes="org/**"/>
    </move>

    <!--
      Cannot run javac from tasks
      http://jira.codehaus.org/browse/MANTRUN-91
    -->
    <javac destdir="${tests.output.dir}/test-classes" debug="true" encoding="utf-8" deprecation="true" fork="true"
      source="1.5" target="1.5">
      <src path="${tests.output.dir}/wstools/java"/>
      <classpath>
        <pathelement path="${maven.test.classpath}"/>
      </classpath>
    </javac>
  </target>

  <target name="copy-resources">

    <copy todir="${tests.output.dir}/test-resources">
      <fileset dir="${tests.output.dir}/wstools/resources">
        <include name="**/*.wsdl"/>
        <include name="**/*.xml"/>
      </fileset>
    </copy>

    <copy todir="${tests.output.dir}/test-resources/jaxrpc/samples" overwrite="true">
      <fileset dir="${tests.resources.dir}/jaxrpc/samples-override"/>
      <filterset>
        <filter token="jboss.bind.address" value="${jboss.bind.address}"/>
      </filterset>
    </copy>
  </target>

  <macrodef name="macro-wstools">
    <attribute name="dest"/>
    <attribute name="config"/>
    <sequential>
      <wstools dest="${tests.output.dir}/wstools/resources/@{dest}" config="${tests.resources.dir}/@{config}">
        <sysproperty key="log4j.output.dir" value="${tests.output.dir}"/>
      </wstools>
    </sequential>
  </macrodef>

</project>
