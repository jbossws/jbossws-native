<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id$ -->

<project>
  
  <import file="${core.dir}/ant-import/jbossws-deploy-macros.xml"/>
  
	<property name="jbossws.default.undeploy.files" value="${core.dir}/ant-import/jbossws.default.undeploy.files"/>
  
  <!-- ================================================================== -->
  <!-- Deployment JBoss421                                                -->
  <!-- ================================================================== -->

  <target name="deploy-jboss421" depends="undeploy-jboss421,prepare-deploy42" description="Deploy jbossws to jboss421">
    <fail message="Not available: ${jboss421.available.file}" unless="jboss421.available"/>
    <copy todir="${jboss421.home}" overwrite="true">
      <fileset dir="${core.output.deploy.dir}" excludes="jbossws.deployed.files"/>
    </copy>
    <chmod dir="${jboss421.home}/bin" perm="+x" includes="*.sh"/>
    
    <!-- Extras for jboss-4.2.1 -->
    <copy todir="${jboss421.home}/lib" overwrite="true">
      <fileset dir="${thirdparty.dir}">
        <include name="jboss-xml-binding.jar"/>
      </fileset>
    </copy>
    <copy todir="${jboss421.home}/client" overwrite="true">
      <fileset dir="${thirdparty.dir}">
        <include name="jboss-xml-binding.jar"/>
      </fileset>
    </copy>
  </target>
  
  <target name="undeploy-jboss421" depends="prepare" description="Remove jbossws from jboss421">
    <fail message="Not available: ${jboss421.available.file}" unless="jboss421.available"/>
    <macro-undeploy-jbossws targetdir="${jboss421.server.deploy}/jbossws.sar"/>
  </target>
  
  <!-- ================================================================== -->
  <!-- Deployment JBoss422                                                -->
  <!-- ================================================================== -->

  <target name="deploy-jboss422" depends="undeploy-jboss422,prepare-deploy42" description="Deploy jbossws to jboss422">
    <fail message="Not available: ${jboss422.available.file}" unless="jboss422.available"/>
    <copy todir="${jboss422.home}" overwrite="true">
      <fileset dir="${core.output.deploy.dir}" excludes="jbossws.deployed.files"/>
    </copy>
    <chmod dir="${jboss422.home}/bin" perm="+x" includes="*.sh"/>
  </target>
  
  <target name="undeploy-jboss422" depends="prepare" description="Remove jbossws from jboss422">
    <fail message="Not available: ${jboss422.available.file}" unless="jboss422.available"/>
    <macro-undeploy-jbossws targetdir="${jboss422.server.deploy}/jbossws.sar"/>
  </target>

  <!-- ================================================================== -->
  <!-- Deployment JBoss423                                                -->
  <!-- ================================================================== -->

  <target name="deploy-jboss423" depends="undeploy-jboss423,prepare-deploy42" description="Deploy jbossws to jboss423">
    <fail message="Not available: ${jboss423.available.file}" unless="jboss423.available"/>
    <copy todir="${jboss423.home}" overwrite="true">
      <fileset dir="${core.output.deploy.dir}" excludes="jbossws.deployed.files"/>
    </copy>
    <chmod dir="${jboss423.home}/bin" perm="+x" includes="*.sh"/>
  </target>
  
  <target name="undeploy-jboss423" depends="prepare" description="Remove jbossws from jboss423">
    <fail message="Not available: ${jboss423.available.file}" unless="jboss423.available"/>
    <macro-undeploy-jbossws targetdir="${jboss423.server.deploy}/jbossws.sar"/>
  </target>
  
  <!-- ================================================================== -->
  <!-- Prepare Deployment JBoss-4.2.x                                     -->
  <!-- ================================================================== -->

  <target name="prepare-deploy42" depends="jars">
    
    <delete dir="${core.output.deploy.dir}-src"/>
    <delete dir="${core.output.deploy.dir}"/>
    
    <!-- Copy all artifacts to a flat deploy src -->
    <unzip dest="${core.output.deploy.dir}-src/bin" src="${thirdparty.dir}/jbossws-framework-scripts.zip"/>
    <unzip dest="${core.output.deploy.dir}-src/bin" src="${core.output.lib.dir}/jbossws-core-scripts.zip"/>
    <copy todir="${core.output.deploy.dir}-src/lib">
      <fileset dir="${thirdparty.dir}">
        <patternset refid="jbossws.client.patternset"/>
        <patternset refid="jbossws.lib.patternset"/>
        <patternset refid="jbossws.lib.endorsed.patternset"/>
        <patternset refid="jbossws.server.lib.patternset"/>
        <patternset refid="jbossws.service.lib.patternset"/>
      </fileset>
      <fileset dir="${core.output.lib.dir}">
        <patternset refid="jbossws.client.patternset"/>
        <patternset refid="jbossws.lib.patternset"/>
        <patternset refid="jbossws.lib.endorsed.patternset"/>
        <patternset refid="jbossws.server.lib.patternset"/>
        <patternset refid="jbossws.service.lib.patternset"/>
        <include name="jbossws-context.war"/>
      </fileset>
    </copy>
    <copy todir="${core.output.deploy.dir}-src/resources">
      <fileset dir="${core.output.resources.dir}">
        <include name="standard-*-config.xml"/>
        <include name="jbossws-native42-beans.xml"/>
      </fileset>
    </copy>
    
    <!-- Create the deployment structure -->
    <antcall target="deploy-jbossws-native42" inheritall="false">
      <param name="installserver" value="${core.output.deploy.dir}/server/${jboss.server.instance}"/>
      <param name="thirdpartylibs" value="${core.output.deploy.dir}-src"/>
    </antcall>
    
    <!-- Create jbossws.deployed.files -->
    <fileset id="jbossws.deploy.fileset" dir="${core.output.deploy.dir}" excludes="**/jbossws.deployed.files,**/jbossws.sar/**"/>
    <property name="jbossws.deploy.fileset" refid="jbossws.deploy.fileset"/>
    <property name="jbossws.sar.dir" value="${core.output.deploy.dir}/server/${jboss.server.instance}/deploy/jbossws.sar"/>
    <echo file="${jbossws.sar.dir}/jbossws.deployed.files" message="${jbossws.deploy.fileset} server/${jboss.server.instance}/deploy/jbossws.sar"/>
    <replace file="${jbossws.sar.dir}/jbossws.deployed.files" token=";" value=" "/>
  </target>
  
</project>
