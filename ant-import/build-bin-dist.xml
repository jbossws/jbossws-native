<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id: build-bin-dist.xml 4081 2007-08-02 09:23:17Z thomas.diesler@jboss.com $ -->

<project>
  
  <!-- ================================================================== -->
  <!-- Binary distribution                                                -->
  <!-- ================================================================== -->
  
  <target name="build-bin-dist" depends="jars,javadoc,prepare-deploy" description="Build the binary distribution">
    
    <property name="bindist.dir" value="${core.output.dir}/jbossws-native-dist"/>
    <property name="bindist.build.dir" value="${bindist.dir}/build"/>
    <property name="bindist.deploy.dir" value="${bindist.dir}/deploy"/>
    <property name="bindist.docs.dir" value="${bindist.dir}/docs"/>
    <property name="bindist.tests.dir" value="${bindist.dir}/tests"/>
    <property name="bindist.tools.dir" value="${bindist.dir}/tools"/>
    
    <delete dir="${bindist.dir}"/>
    <mkdir dir="${bindist.build.dir}"/>
    <mkdir dir="${bindist.deploy.dir}"/>
    <mkdir dir="${bindist.docs.dir}"/>
    <mkdir dir="${bindist.tests.dir}"/>
    <mkdir dir="${bindist.tools.dir}"/>
    
    <!-- root -->
    <copy file="${core.distro.dir}/ant.properties.example" todir="${bindist.dir}">
      <filterset>
        <filtersfile file="${core.dir}/ant.properties"/>
      </filterset>
    </copy>
    <copy tofile="${bindist.dir}/version.properties" file="${core.dir}/version.properties"/>
    <copy tofile="${bindist.dir}/build.xml" file="${core.distro.dir}/bin-dist-build.xml"/>
    <copy tofile="${bindist.build.dir}/build-project-gen.xml" file="${core.distro.dir}/bin-dist-project-gen.xml"/>
    
    <!-- build -->
    <copy todir="${bindist.build.dir}">
      <fileset dir="${core.dir}/ant-import">
        <include name="build-deploy.xml"/>
        <include name="jbossws-deploy-macros.xml"/>
        <include name="jbossws-default-deploy.conf"/>
      </fileset>
      <fileset dir="${core.distro.dir}">
        <include name="user-project-build.xml"/>
        <include name="eclipse.project"/>
      </fileset>
    </copy>
    
    <!-- deploy -->
    <copy todir="${bindist.deploy.dir}">
      <fileset dir="${deploy.artifacts.dir}"/>
    </copy>
    
    <!-- docs -->
    <copy todir="${bindist.docs.dir}">
      <fileset dir="${core.output.dir}">
        <include name="apidocs/**"/>
      </fileset>
    </copy>
    <copy todir="${bindist.docs.dir}" filtering="yes">
      <fileset dir="${core.distro.dir}">
        <include name="Install.txt"/>
        <include name="ReleaseNotes.txt"/>
      </fileset>
      <filterset>
        <filtersfile file="${core.dir}/version.properties"/>
      </filterset>
    </copy>
    
    <copy todir="${bindist.docs.dir}">
      <fileset dir="${core.etc.dir}">
        <include name="JBossORG-EULA.txt"/>
      </fileset>
    </copy>
    
    <!-- tests -->
    <copy todir="${bindist.tests.dir}" overwrite="true">
      <fileset dir="${core.dir}/src/test-framework">
        <include name="ant-import/build-testsuite.xml"/>
        <include name="ant-import/build-samples-jaxws.xml"/>
        <include name="etc/**"/>
        <include name="java/**/jaxws/samples/**"/>
        <include name="java/**/jaxws/smoke/**"/>
        <include name="java/**/projectGenerator/**"/>
        <include name="resources/jaxws/samples/**"/>
        <include name="resources/jaxws/smoke/**"/>
        <include name="resources/projectGenerator/**"/>
      </fileset>
      <fileset dir="${core.dir}/src/test">
        <include name="resources/test-excludes-*.txt"/>
        <include name="etc/log4j.xml"/>
      </fileset>
    </copy>
    
    <!-- build tools -->
    <copy todir="${bindist.tools.dir}" overwrite="true">
      <fileset dir="${core.dir}/tools"/>
    </copy>
    <copy todir="${bindist.dir}" overwrite="true">
      <fileset dir="${core.dir}">
        <include name="build.bat"/>
        <include name="build.sh"/>
      </fileset>
    </copy>
    <chmod file="${bindist.dir}/build.sh" perm="+x"/>
    
    <zip destfile="${core.output.dir}/jbossws-${version.id}.zip">
      <fileset dir="${core.output.dir}" includes="jbossws-native-dist/**"/>
    </zip>
  </target>
  
</project>