<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id: macros-deploy-native.xml 4081 2007-08-02 09:23:17Z thomas.diesler@jboss.com $ -->

<project>
  
  <!-- 
  These patterns should be common for all supported containers 
  Exceptions must be defined in the individual deploy macros.
  -->
  <patternset id="client.patternset">
    <include name="jbossws-client.jar"/>
    <include name="jbossws-common.jar"/>
    <include name="jbossws-framework.jar"/>
    <include name="jbossws-spi.jar"/>
    <include name="jaxb-api.jar"/>
    <include name="jaxb-impl.jar"/>
    <include name="jaxb-xjc.jar"/>
    <include name="jaxws-tools.jar"/>
    <include name="jaxws-rt.jar"/>
    <include name="jboss-jaxrpc.jar"/>
    <include name="jboss-jaxws.jar"/>
    <include name="jboss-jaxws-ext.jar"/>
    <include name="jboss-saaj.jar"/>
    <include name="policy.jar"/>
    <include name="stax-ex.jar"/>
    <include name="streambuffer.jar"/>
    <include name="wsdl4j.jar"/>
  </patternset>
  
  <patternset id="lib.patternset">
    <include name="jaxb-api.jar"/>
    <include name="jaxb-impl.jar"/>
  </patternset>
  
  <patternset id="lib.endorsed.patternset">
    <include name="jboss-jaxrpc.jar"/>
    <include name="jboss-jaxws.jar"/>
    <include name="jboss-jaxws-ext.jar"/>
    <include name="jboss-saaj.jar"/>
    <include name="jaxb-api.jar"/>
  </patternset>
  
  <patternset id="server.lib.patternset">
    <include name="jbossws-common.jar"/>
    <include name="jbossws-framework.jar"/>
    <include name="jbossws-spi.jar"/>
    <include name="jboss-jaxrpc.jar"/>
    <include name="jboss-jaxws.jar"/>
    <include name="jboss-jaxws-ext.jar"/>
    <include name="jboss-saaj.jar"/>
  </patternset>
  
  <!-- ================================================================== -->
  <!-- Deploy Endorsed                                                    -->
  <!-- ================================================================== -->
  
  <!-- Deploy API jars to lib/endorsed for usage with jdk1.6 -->
  <macrodef name="macro-deploy-endorsed">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      <mkdir dir="${core.output.deploy.dir}/lib/endorsed"/>
      <copy todir="${core.output.deploy.dir}/lib/endorsed" overwrite="true">
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="lib.endorsed.patternset"/>
        </fileset>
        <fileset dir="@{stacklibs}">
          <patternset refid="lib.endorsed.patternset"/>
        </fileset>
      </copy>
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deploy Framework                                                   -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-framework">
    <attribute name="thirdpartylibs"/>
    <sequential>
      
      <!-- BIN SCRIPTS -->
      <unzip dest="${core.output.deploy.dir}/bin" src="@{thirdpartylibs}/jbossws-framework-scripts.zip"/>
      <chmod dir="${core.output.deploy.dir}/bin" perm="+x" includes="*.sh"/>
      
      <!-- CLIENT JARS-->
      <copy todir="${core.output.deploy.dir}/client">
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="client.patternset"/>
        </fileset>
      </copy>
      
      <!-- SERVER LIB JARS-->
      <copy todir="${core.output.deploy.dir}/server/${jboss.server.instance}/lib">
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="server.lib.patternset"/>
        </fileset>
      </copy>
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deploy JBossWS                                                     -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-jbossws">
    <attribute name="jbosshome"/>
    <attribute name="sarname"/>
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      
      <!-- Deploy the sars -->
      <mkdir dir="@{jbosshome}/server/${jboss.server.instance}/deploy/jbossws.sar"/>
      <unjar dest="@{jbosshome}/server/${jboss.server.instance}/deploy/jbossws.sar" src="@{stacklibs}/@{sarname}"/>
      <mkdir dir="@{jbosshome}/server/${jboss.server.instance}/deploy/juddi-service.sar"/>
      <unzip dest="@{jbosshome}/server/${jboss.server.instance}/deploy/juddi-service.sar" src="@{thirdpartylibs}/juddi-service.sar"/>
      
      <!-- Deploy the jars -->
      <fileset id="jbossws.deploy.files" dir="${core.output.deploy.dir}" excludes="jbossws.deployed.files"/>
      <copy todir="@{jbosshome}" overwrite="true">
        <fileset refid="jbossws.deploy.files"/>
      </copy>
      
      <!-- Write jbossws.deployed.files -->
      <property name="jbossws.deploy.files" refid="jbossws.deploy.files"/>
      <echo file="${core.output.deploy.dir}/jbossws.deployed.files" message="${jbossws.deploy.files}"/>
      <replace file="${core.output.deploy.dir}/jbossws.deployed.files" token=";" value=" "/>
      <copy todir="@{jbosshome}/server/${jboss.server.instance}/deploy/jbossws.sar" file="${core.output.deploy.dir}/jbossws.deployed.files" overwrite="true"/>
      
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Undeploy JBossWS                                                   -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-undeploy-jbossws">
    <attribute name="jbosshome"/>
    <sequential>
      
      <delete dir="${core.output.deploy.dir}"/>
      
      <loadfile property="jbossws.undeploy.files" srcfile="@{jbosshome}/server/${jboss.server.instance}/deploy/jbossws.sar/jbossws.deployed.files" failonerror="false"/>
      <loadfile property="jbossws.undeploy.files" srcfile="${core.dir}/ant-import/jbossws.default.undeploy.files" failonerror="false"/>
      <delete dir="@{jbosshome}/server/${jboss.server.instance}/deploy/jbossws.sar"/>
      <delete dir="@{jbosshome}/server/${jboss.server.instance}/deploy/juddi-service.sar"/>
      <delete>
        <fileset dir="@{jbosshome}" includes="${jbossws.undeploy.files}"/>
      </delete>
      
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deployment JBoss-4.2.1                                             -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-native421">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      <fail message="Not available: ${jboss421.available.file}" unless="jboss421.available"/>
      
      <!-- BIN SCRIPTS -->
      <mkdir dir="${core.output.deploy.dir}/bin"/>
      <unzip dest="${core.output.deploy.dir}/bin" src="@{stacklibs}/jbossws-core-scripts.zip"/>
      <chmod dir="${core.output.deploy.dir}/bin" perm="+x" includes="*.sh"/>
      
      <!-- CLIENT JARS -->
      <mkdir dir="${core.output.deploy.dir}/client"/>
      <copy todir="${core.output.deploy.dir}/client" overwrite="true">
        <fileset dir="@{stacklibs}">
          <patternset refid="client.patternset"/>
          <include name="jbossws-jboss421.jar"/>
        </fileset>
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="client.patternset"/>
          <include name="jboss-xml-binding.jar"/>
        </fileset>
      </copy>
      
      <!-- LIB JARS -->
      <mkdir dir="${core.output.deploy.dir}/lib"/>
      <copy todir="${core.output.deploy.dir}/lib" overwrite="true">
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="lib.patternset"/>
          <include name="jboss-xml-binding.jar"/>
        </fileset>
      </copy>
      
      <!-- SERVER LIB JARS -->
      <mkdir dir="${core.output.deploy.dir}/server/${jboss.server.instance}/lib"/>
      <copy todir="${core.output.deploy.dir}/server/${jboss.server.instance}/lib" overwrite="true">
        <fileset dir="@{thirdpartylibs}">
          <include name="jbossws-jboss421.jar"/>
        </fileset>
      </copy>
      
      <macro-deploy-jbossws jbosshome="${jboss421.home}" sarname="jbossws-native42.sar" stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
      
    </sequential>
  </macrodef>
  
  <macrodef name="macro-undeploy-native421">
    <sequential>
      <fail message="Not available: ${jboss421.available.file}" unless="jboss421.available"/>
      <macro-undeploy-jbossws jbosshome="${jboss421.home}"/>
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deployment  JBoss-4.2.x                                            -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-native42x">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      
      <!-- BIN SCRIPTS -->
      <mkdir dir="${core.output.deploy.dir}/bin"/>
      <unzip dest="${core.output.deploy.dir}/bin" src="@{stacklibs}/jbossws-core-scripts.zip"/>
      <chmod dir="${core.output.deploy.dir}/bin" perm="+x" includes="*.sh"/>
      
      <!-- CLIENT JARS -->
      <mkdir dir="${core.output.deploy.dir}/client"/>
      <copy todir="${core.output.deploy.dir}/client" overwrite="true">
        <fileset dir="@{stacklibs}">
          <patternset refid="client.patternset"/>
        </fileset>
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="client.patternset"/>
        </fileset>
      </copy>
      
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deployment  JBoss-4.2.2                                            -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-native422">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      <fail message="Not available: ${jboss422.available.file}" unless="jboss422.available"/>
      <macro-deploy-native42x stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
      <macro-deploy-jbossws jbosshome="${jboss422.home}" sarname="jbossws-native42.sar" stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
    </sequential>
  </macrodef>
  
  <macrodef name="macro-undeploy-native422">
    <sequential>
      <fail message="Not available: ${jboss422.available.file}" unless="jboss422.available"/>
      <macro-undeploy-jbossws jbosshome="${jboss422.home}"/>
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deployment  JBoss-4.2.3                                            -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-native423">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      <fail message="Not available: ${jboss423.available.file}" unless="jboss423.available"/>
      <macro-deploy-native42x stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
      <macro-deploy-jbossws jbosshome="${jboss423.home}" sarname="jbossws-native42.sar" stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
    </sequential>
  </macrodef>
  
  <macrodef name="macro-undeploy-native423">
    <sequential>
      <fail message="Not available: ${jboss423.available.file}" unless="jboss423.available"/>
      <macro-undeploy-jbossws jbosshome="${jboss423.home}"/>
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deployment  JBoss-5.0.x                                            -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-native50x">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      
      <!-- BIN SCRIPTS -->
      <mkdir dir="${core.output.deploy.dir}/bin"/>
      <unzip dest="${core.output.deploy.dir}/bin" src="@{stacklibs}/jbossws-core-scripts.zip"/>
      <chmod dir="${core.output.deploy.dir}/bin" perm="+x" includes="*.sh"/>
      
      <!-- CLIENT JARS -->
      <mkdir dir="${core.output.deploy.dir}/client"/>
      <copy todir="${core.output.deploy.dir}/client" overwrite="true">
        <fileset dir="@{stacklibs}">
          <patternset refid="client.patternset"/>
        </fileset>
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="client.patternset"/>
        </fileset>
      </copy>
      
      <!-- LIB JARS -->
      <mkdir dir="${core.output.deploy.dir}/lib"/>
      <copy todir="${core.output.deploy.dir}/lib" overwrite="true">
        <fileset dir="@{thirdpartylibs}">
          <patternset refid="lib.patternset"/>
        </fileset>
      </copy>
      
      <!-- SERVER JARS -->
      <copy todir="${core.output.deploy.dir}/server/${jboss.server.instance}/lib" overwrite="true">
        <fileset dir="@{stacklibs}">
          <patternset refid="server.lib.patternset"/>
        </fileset>
      </copy>
      
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deployment  JBoss-5.0.0                                            -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-native500">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      <fail message="Not available: ${jboss500.available.file}" unless="jboss500.available"/>
      <macro-deploy-native50x stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
      <macro-deploy-jbossws jbosshome="${jboss500.home}" sarname="jbossws-native50.sar" stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
    </sequential>
  </macrodef>
  
  <macrodef name="macro-undeploy-native500">
    <sequential>
      <fail message="Not available: ${jboss500.available.file}" unless="jboss500.available"/>
      <macro-undeploy-jbossws jbosshome="${jboss500.home}"/>
    </sequential>
  </macrodef>
  
  <!-- ================================================================== -->
  <!-- Deployment  JBoss-5.0.1                                            -->
  <!-- ================================================================== -->
  
  <macrodef name="macro-deploy-native501">
    <attribute name="stacklibs"/>
    <attribute name="thirdpartylibs"/>
    <sequential>
      <fail message="Not available: ${jboss501.available.file}" unless="jboss501.available"/>
      <macro-deploy-native50x stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
      <macro-deploy-jbossws jbosshome="${jboss501.home}" sarname="jbossws-native50.sar" stacklibs="@{stacklibs}" thirdpartylibs="@{thirdpartylibs}"/>
    </sequential>
  </macrodef>
  
  <macrodef name="macro-undeploy-native501">
    <sequential>
      <fail message="Not available: ${jboss501.available.file}" unless="jboss501.available"/>
      <macro-undeploy-jbossws jbosshome="${jboss501.home}"/>
    </sequential>
  </macrodef>
  
</project>